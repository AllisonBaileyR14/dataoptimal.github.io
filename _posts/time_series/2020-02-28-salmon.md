---
title: "Salmon Passage Project"
date: 2020-02-28
tags: [data wrangling, data science, messy data]
header:
  image: "/images/geo_map2.png"
excerpt: "Data Wrangling, Data Science, Messy Data"
mathjax: "true"
---

## Adult Steelhead passage through the Bonneville Dam

<img src="{{ site.url }}{{ site.baseurl }}/images/steelhead.jpg">

## **Introduction**

Steelhead Trout, (*Oncorhynchus mykiss*), travel great distances to spawn in fresh-water rivers and streams.  
While some migrate back to the ocean, all Steelhead Trout hatch in fast flowing rivers and streams that are well-oxygenated[1]. 
These species are protected, as they have long been vulnerable dams blocking their spawning grounds as well as other anthropogenic 
degradation of aquatic habitats. In this report, we focus on adult Steelhead Trout pass through the Bonneville Dam which is located 
on the Columbia River east of Portland, OR. Bonneville Dam is a crucial power and water resource management system that is critical 
in managing fish and wildlife habitat[2].

Data from the Columbia River DART, Columbia Basin Research, University of Washington was utilized in this report to analyze time series 
trends in Adult Steelhead passage through the Bonneville Dam[3]. 


The graph below displays a map of :
<img width="100%" height="auto" src="{{ site.url }}{{ site.baseurl }}/images/daily_count.png">

The graph below displays a map of :
<img width="100%" height="auto" src="{{ site.url }}{{ site.baseurl }}/images/monthly_count.png">

The graph below displays a map of :
<img width="100%" height="auto" src="{{ site.url }}{{ site.baseurl }}/images/quarterly_count.png">

The graph below displays a map of :
<img width="100%" height="auto" src="{{ site.url }}{{ site.baseurl }}/images/annual_count.png">

Here is the R Markdown document to how these graphs were produced:
<iframe width="100%" height="500px" src="../images/bonn_fish_bailey.html" class="cool"></iframe>

Here is the reproducible code:
```r
# Attach packages

library(tidyverse)
library(janitor)
library(naniar)
library(VIM)
library(skimr)
library(ggfortify)
library(here)
library(lubridate)
library(anytime)
library(ggridges)
library(viridis)
library(hrbrthemes)
library(paletteer)
library(kableExtra)
library(ggpubr)
library(sf)
library(tmap)
library(DT)
library(plotly)
library(expss)
library(ggthemes)
library(knitr)
library(tsibble)
library(fable)
library(fabletools)
library(feasts)
library(forecast)

# drop the na's, parse the dates to have their own columns for ymd with lubridate. Use  mutate(date = paste(year, mm_dd, sep = "_")) to change format to date format. 

bonn_fish <- read_csv("bonneville_fish.csv") %>%
  clean_names() %>%
  mutate(date = paste(year, mm_dd, sep = "_")) %>% 
  mutate(date_parse = lubridate::ydm(date)) %>%
  mutate(month_sep = yearmonth(date_parse)) %>% #coerce to tsibble `yearmonth` format
  mutate(value = as.numeric(value)) %>% 
  drop_na(month_sep, value) %>%
  mutate(month = month(date_parse)) %>%
  mutate(day = day(date_parse)) 
  
#Insert snowshoe hare and map image with caption

include_graphics("image0.jpeg")

# A finalized time series plot of the original observations (daily data). 

fish_time <- ggplot(bonn_fish, aes(x = date_parse, y = value)) +
  geom_line() + 
 theme_light() +
  theme(
    legend.position="none",
    plot.title = element_text(size=14)
  ) +
  theme(
    plot.title=element_text(hjust=0.5, vjust=0.5, face='bold'),
    plot.subtitle = element_text(hjust=0.5, vjust=0.5, face='italic')
  ) +
  labs(x = "Year",
       y = "Count",
       title = "Daily Adult Steelhead Count Time Series",
       subtitle = "Passage through Bonneville Dam")

fish_time

# Create a tibble for monthly counts

fish_tibble <- bonn_fish %>%
  dplyr::select(month_sep, value) %>%
  group_by(month_sep) %>%
  summarise(
    month_total = sum(value)
  )

bonn_ts <- as_tsibble(fish_tibble, index = month_sep)

# A finalized seasonplot to explore if/how monthly passage has shifted over time (I totaled counts by month before doing this...you can choose if you want to do that).  Steelhead can been seen throughout the year although most steelhead move past the lower Columbia River dams from July through September. There are two runs of steelhead: Summer: April through October. Winter: November through April.

bonn_monthly <- ggplot(data = bonn_fish, aes(x = month, y = value, group = year)) +
  geom_jitter(aes(color = year)) +
  scale_color_viridis() +
  theme_light() +
  theme(
    legend.position="right",
    plot.title = element_text(size=14)
  ) +
  theme(
    plot.title=element_text(hjust=0.5, vjust=0.5, face='bold'),
    plot.subtitle = element_text(hjust=0.5, vjust=0.5, face='italic')
  ) +
  labs(x = "Month",
       y = "Count",
       title = "Monthly Adult Steelhead Count Overlay: 1939-2020",
       subtitle = "Passage through Bonneville Dam")

bonn_monthly

# Now that we did a monthly, let's do a quarterly/seasonal graph

bonn_quarterly <- bonn_ts %>% 
  index_by(year_qu = ~ yearquarter(.)) %>% # monthly aggregates
  summarise(
    avg_count = mean(month_total)
  )

bonn_seasonal <- ggplot(data = bonn_quarterly, aes(x = year_qu, y = avg_count)) +
  geom_line(color = "darkorange") +
  geom_smooth(color = "purple",
              size = 0.2,
              linetype = "dashed",
              fill = "purple",
              alpha = 0.2) +
  theme_minimal() +
   theme_light() +
  theme(
    legend.position="none",
    plot.title = element_text(size=14)
  ) +
  theme(
    plot.title=element_text(hjust=0.5, vjust=0.5, face='bold'),
    plot.subtitle = element_text(hjust=0.5, vjust=0.5, face='italic')
  ) +
  labs(x = "Quarter",
       y = "Count",
       title = "Quarterly Adult Steelhead Avg. Count Time Series",
       subtitle = "Passage through Bonneville Dam")

bonn_seasonal


kable(bonn_quarterly, col.names = c("Year/Quarter","Count"),
      caption = "***Figure 5.** The table below displays quarterly counts of steelhead fish passing through Bonneville Dam in the Columbia River.*") %>% 
  kable_styling(bootstrap_options = "striped", position = "center") %>%
  add_header_above(c("Adult Steelhead Passage Count" = 2)) %>%
  scroll_box(width = "500px", height = "200px")

# A finalized visualization of annual steelhead passage counts 


bonn_annual <-bonn_ts %>% 
  index_by(annual = ~year(.)) %>% 
  summarize(
    avg_count = mean(month_total)
  )

bonn_annual_plot <- ggplot(data = bonn_annual, aes(x = annual, y = avg_count)) +
  geom_line(color = "darkorange") +
  geom_smooth(color = "purple",
              size = 0.2,
              linetype = "dashed",
              fill = "purple",
              alpha = 0.2) +
   theme_light() +
  theme(
    legend.position="none",
    plot.title = element_text(size=14)
  ) +
  theme(
    plot.title=element_text(hjust=0.5, vjust=0.5, face='bold'),
    plot.subtitle = element_text(hjust=0.5, vjust=0.5, face='italic')
  ) +
  labs(x = "Year",
       y = "Count",
       title = "Annual Adult Steelhead Avg. Count Time Series",
       subtitle = "Passage through Bonneville Dam")

bonn_annual_plot
```



